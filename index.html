<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Spotify大盘</title>
        
<!-- TailwindCSS for styling -->
<script src="https://image.uc.cn/s/uae/g/3n/mos-production/0915/3.4.17.js"></script>
        
<!-- Font Awesome for icons -->
<script src="https://image.uc.cn/s/uae/g/3n/mos-production/fontawesome-free-7.1.0-web/js/all.min.js"></script>
<link href="https://image.uc.cn/s/uae/g/3n/mos-production/fontawesome-free-7.1.0-web/css/fontawesome.min.css" rel="stylesheet"/>
        
<!-- ECharts for data visualization -->
<script src="https://image.uc.cn/s/uae/g/3n/mos-production/cdn-staticfile-net/echarts/5.4.3/echarts.min.js"></script>
        
<!-- 标签页图标 -->
<link rel="icon" type="image/png" href="/favicon.ico">
<!-- Custom Styles -->
<style>
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        /* Smooth transitions for interactive elements */
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }

        /* Custom date picker icon styling */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased overflow-hidden">
<!-- Main Layout Container -->
<div class="flex h-screen w-full">
<!-- Sidebar Section -->
<aside class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col shadow-xl z-20 transition-all-300 hidden md:flex">
<!-- Sidebar Header / Logo -->
<div class="h-16 flex items-center px-6 border-b border-gray-700">
<i class="fa-solid fa-music text-green-500 text-xl mr-3"></i>
<span class="text-lg font-bold tracking-wide">MusicData</span>
</div>
<!-- Navigation Menu -->
<nav class="flex-1 overflow-y-auto py-4">
<ul class="space-y-1">
<!-- Active Menu Item -->
<li>
<a class="flex items-center px-6 py-3 bg-gray-900 text-green-400 border-r-4 border-green-500 group transition-all-300" href="#">
<i class="fa-brands fa-spotify w-6 text-center mr-2"></i>
<span class="font-medium">Spotify每日大盘</span>
</a>
</li>
<!-- Placeholder for future modules (Extensible Interface) -->
<li>
<a class="flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700 hover:text-white transition-all-300 group" href="#" onclick="handleFutureFeature(event)">
<i class="fa-solid fa-chart-line w-6 text-center mr-2 group-hover:text-blue-400"></i>
<span class="font-medium">Apple Music趋势</span>
<span class="ml-auto text-xs bg-gray-700 px-2 py-0.5 rounded text-gray-300">Soon</span>
</a>
</li>
<li>
<a class="flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700 hover:text-white transition-all-300 group" href="#" onclick="handleFutureFeature(event)">
<i class="fa-solid fa-globe w-6 text-center mr-2 group-hover:text-purple-400"></i>
<span class="font-medium">全球榜单归档</span>
</a>
</li>
</ul>
</nav>
<!-- Sidebar Footer -->
<div class="p-4 border-t border-gray-700 text-xs text-gray-500 text-center">
                © 2026 MusicData Project
            </div>
</aside>
<!-- Main Content Area -->
<main class="flex-1 flex flex-col h-screen overflow-hidden relative">
<!-- Mobile Header (Visible only on small screens) -->
<header class="md:hidden h-16 bg-gray-800 flex items-center px-4 justify-between border-b border-gray-700">
<div class="flex items-center">
<i class="fa-solid fa-music text-green-500 text-lg mr-2"></i>
<span class="font-bold">MusicData</span>
</div>
<button class="text-gray-300 hover:text-white focus:outline-none">
<i class="fa-solid fa-bars text-xl"></i>
</button>
</header>
<!-- Scrollable Content -->
<div class="flex-1 overflow-y-auto p-6 md:p-10">
<!-- Page Title Section -->
<div class="mb-8">
<h1 class="text-3xl font-bold text-white mb-2">Spotify每日大盘查询</h1>
<p class="text-gray-400">查询每日全球大盘指数</p>
</div>
<!-- Control Panel: Date Picker -->
<div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700 mb-6 flex flex-col sm:flex-row items-center justify-between gap-4">
<div class="flex items-center w-full sm:w-auto">
<label class="text-gray-300 font-medium mr-4 whitespace-nowrap" for="datePicker">
<i class="fa-regular fa-calendar mr-2"></i>选择日期
                        </label>
<input class="bg-gray-900 border border-gray-600 text-white text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full sm:w-48 p-2.5 outline-none transition-all-300 hover:border-gray-500" id="datePicker" type="date"/>
</div>
<!-- Quick Actions (Visual Only) -->
<div class="flex gap-2">
<button class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm text-gray-300 transition-colors" onclick="adjustDate(-1)">
<i class="fa-solid fa-chevron-left"></i> 前一天
                        </button>
<button class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded text-sm text-white font-medium transition-colors shadow-lg shadow-green-900/50" onclick="setToday()">
                            回到今天
                        </button>
<button class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm text-gray-300 transition-colors" onclick="adjustDate(1)">
                            后一天 <i class="fa-solid fa-chevron-right"></i>
</button>
</div>
</div>
<!-- Data Display Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
<!-- Main Metric Card -->
<div class="lg:col-span-1 bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 shadow-lg border border-gray-700 relative overflow-hidden group">
<div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
<i class="fa-brands fa-spotify text-8xl text-green-500"></i>
</div>
<h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-1">当日大盘数值</h3>
<div class="flex items-baseline mt-2">
<span class="text-5xl font-bold text-white tracking-tight" id="marketValue">--</span>
<span class="ml-2 text-sm text-green-400 font-medium" id="trendIndicator">
<i class="fa-solid fa-arrow-trend-up"></i> --
                            </span>
</div>
<p class="text-gray-500 text-xs mt-4">数据来源: spotify</p>
</div>
<!-- Chart Card -->
<div class="lg:col-span-2 bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700 flex flex-col">
<div class="flex justify-between items-center mb-4">
<h3 class="text-gray-300 font-medium">近7日趋势图</h3>
<div class="flex gap-2">
<span class="w-3 h-3 rounded-full bg-green-500 inline-block"></span>
<span class="text-xs text-gray-500">大盘指数</span>
</div>
</div>
<!-- ECharts Container -->
<div class="w-full h-64 flex-1" id="trendChart"></div>
</div>
</div>
<!-- Detailed Info Section (Placeholder for extensibility) -->
<div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
<h3 class="text-lg font-medium text-white mb-4 border-b border-gray-700 pb-2">数据详情</h3>
<div class="text-gray-400 text-sm" id="detailsContent">
<p>正在加载数据...</p>
</div>
</div>
</div>
</main>
</div>
<!-- Toast Notification Container -->
<div class="fixed bottom-5 right-5 z-50 flex flex-col gap-2" id="toastContainer"></div>
<!-- JavaScript Logic -->
<script>
         // ✅ 替换：不再内嵌数据，改为从外部 JSON 文件加载
        let SPOTIFY_DAILY_DATA = null;
        const CURRENT_DATE = "2026-02-18";

        // DOM Elements（保持不变）
        const datePicker = document.getElementById('datePicker');
        const marketValueEl = document.getElementById('marketValue');
        const trendIndicatorEl = document.getElementById('trendIndicator');
        const detailsContentEl = document.getElementById('detailsContent');
        const chartDom = document.getElementById('trendChart');
        let myChart = null;

        /**
        * 初始化应用（稍作调整：等数据加载完再 init）
        */
        function initApp() {
                // Set default date to current date
                datePicker.value = CURRENT_DATE;
                datePicker.max = "2026-12-31"; // Optional constraint
        
                // Initialize ECharts instance
                myChart = echarts.init(chartDom);
        
                // Handle window resize
                window.addEventListener('resize', () => {
                    myChart.resize();
                });
        
                // Event listener for date change
                datePicker.addEventListener('change', (e) => {
                    updateDashboard(e.target.value);
                });
        
                // Initial load
                updateDashboard(CURRENT_DATE);
            }

            // ✅ 新增：加载数据后启动应用
        fetch('data/spotify_daily.json')
                .then(response => {
                    if (!response.ok) throw new Error('未找到 data/spotify_daily.json');
                    return response.json();
                })
                .then(data => {
                    // 假设你的 JSON 是数组格式，如 [{date: "...", value: ...}, ...]
                    SPOTIFY_DAILY_DATA = data;
                    initApp(); // 数据就绪，初始化
                })
                .catch(err => {
                    console.error('数据加载失败:', err);
                    // 显示错误到页面（可选）
                    document.getElementById('marketValue').innerText = '❌';
                    document.getElementById('detailsContent').innerHTML = 
                        `<p class="text-red-400"><i class="fa-solid fa-triangle-exclamation mr-2"></i>数据加载失败：${err.message}</p>`;
                });

        

        /**
         * Update the dashboard based on selected date
         * @param {string} dateStr - Date string in YYYY-MM-DD format
         */
        function updateDashboard(dateStr) {
            const record = SPOTIFY_DAILY_DATA.find(item => item.date === dateStr);

            if (record) {
                // Update Value Display
                animateValue(marketValueEl, parseInt(marketValueEl.innerText.replace(/,/g, '')) || 0, record.value, 800);
                
                // Calculate Trend (Compare with previous day if available)
                updateTrend(dateStr, record.value);

                // Update Details
                detailsContentEl.innerHTML = `
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="block text-gray-500 text-xs">记录日期</span>
                            <span class="text-white font-mono">${record.date}</span>
                        </div>
                        <div>
                            <span class="block text-gray-500 text-xs">数据状态</span>
                            <span class="text-green-400"><i class="fa-solid fa-check-circle"></i> 已校验</span>
                        </div>
                        <div class="col-span-2">
                            <span class="block text-gray-500 text-xs">备注</span>
                            <span class="text-gray-300">该数据反映当日Spotify全球活跃流媒体播放总量指数。</span>
                        </div>
                    </div>
                `;

                // Update Chart
                updateChart(dateStr);

            } else {
                // Handle Not Found
                marketValueEl.innerText = "N/A";
                trendIndicatorEl.innerHTML = `<span class="text-gray-500">无数据</span>`;
                detailsContentEl.innerHTML = `<p class="text-red-400"><i class="fa-solid fa-triangle-exclamation mr-2"></i>未找到 ${dateStr} 的记录数据。</p>`;
                
                // Clear chart or show empty state
                myChart.clear();
                myChart.setOption({
                    title: { text: '暂无数据', left: 'center', top: 'center', textStyle: { color: '#6b7280' } },
                    grid: { top: 0, bottom: 0, left: 0, right: 0 }
                });
            }
        }

        /**
         * Calculate and display trend compared to previous day
         */
        function updateTrend(currentDate, currentValue) {
            const currentIndex = SPOTIFY_DAILY_DATA.findIndex(item => item.date === currentDate);
            if (currentIndex > 0) {
                const prevValue = SPOTIFY_DAILY_DATA[currentIndex - 1].value;
                const diff = currentValue - prevValue;
                const percent = ((diff / prevValue) * 100).toFixed(2);
                
                if (diff >= 0) {
                    trendIndicatorEl.className = "ml-2 text-sm text-green-400 font-medium";
                    trendIndicatorEl.innerHTML = `<i class="fa-solid fa-arrow-trend-up"></i> +${percent}%`;
                } else {
                    trendIndicatorEl.className = "ml-2 text-sm text-red-400 font-medium";
                    trendIndicatorEl.innerHTML = `<i class="fa-solid fa-arrow-trend-down"></i> ${percent}%`;
                }
            } else {
                trendIndicatorEl.className = "ml-2 text-sm text-gray-500 font-medium";
                trendIndicatorEl.innerHTML = `--`;
            }
        }

        /**
         * Update ECharts visualization
         */
        function updateChart(targetDate) {
            // Find data for the week surrounding the target date
            const targetIndex = SPOTIFY_DAILY_DATA.findIndex(item => item.date === targetDate);
            let startIndex = Math.max(0, targetIndex - 3);
            let endIndex = Math.min(SPOTIFY_DAILY_DATA.length - 1, targetIndex + 3);
            
            // Ensure we have a range of at least 1
            if (targetIndex === -1) return;

            const chartData = SPOTIFY_DAILY_DATA.slice(startIndex, endIndex + 1);
            const dates = chartData.map(item => item.date.slice(5)); // Show MM-DD
            const values = chartData.map(item => item.value);

            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(31, 41, 55, 0.9)',
                    borderColor: '#4b5563',
                    textStyle: { color: '#fff' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: dates,
                    axisLine: { lineStyle: { color: '#4b5563' } },
                    axisLabel: { color: '#9ca3af' }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { color: '#374151', type: 'dashed' } },
                    axisLabel: { color: '#9ca3af' }
                },
                series: [
                    {
                        name: '大盘指数',
                        type: 'line',
                        smooth: true,
                        data: values,
                        symbolSize: 8,
                        itemStyle: {
                            color: '#22c55e' // Green-500
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(34, 197, 94, 0.5)' },
                                { offset: 1, color: 'rgba(34, 197, 94, 0.0)' }
                            ])
                        },
                        lineStyle: {
                            width: 3,
                            shadowColor: 'rgba(34, 197, 94, 0.5)',
                            shadowBlur: 10
                        }
                    }
                ]
            };

            myChart.setOption(option);
        }

        /**
         * Helper: Number animation
         */
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const currentVal = Math.floor(progress * (end - start) + start);
                obj.innerHTML = currentVal.toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        /**
         * Helper: Adjust date by days
         */
        function adjustDate(days) {
            const current = new Date(datePicker.value);
            current.setDate(current.getDate() + days);
            const newDateStr = current.toISOString().split('T')[0];
            datePicker.value = newDateStr;
            updateDashboard(newDateStr);
        }

        /**
         * Helper: Set date to today (2026-02-18 in this context)
         */
        function setToday() {
            datePicker.value = CURRENT_DATE;
            updateDashboard(CURRENT_DATE);
            showToast("已回到今天", "success");
        }

        /**
         * Helper: Handle future feature clicks
         */
        function handleFutureFeature(e) {
            e.preventDefault();
            showToast("该功能模块正在开发中，敬请期待！", "info");
        }

        /**
         * UI Component: Toast Notification
         */
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            // Colors based on type
            let bgClass = "bg-gray-800";
            let borderClass = "border-gray-600";
            let icon = '<i class="fa-solid fa-circle-info text-blue-400"></i>';

            if (type === 'success') {
                borderClass = "border-green-500";
                icon = '<i class="fa-solid fa-circle-check text-green-400"></i>';
            }

            toast.className = `${bgClass} border-l-4 ${borderClass} text-white px-4 py-3 rounded shadow-lg flex items-center gap-3 transform transition-all duration-300 translate-y-10 opacity-0 min-w-[250px]`;
            toast.innerHTML = `
                ${icon}
                <span class="text-sm font-medium">${message}</span>
            `;

            container.appendChild(toast);

            // Animate in
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            });

            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Run initialization when DOM is ready
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
